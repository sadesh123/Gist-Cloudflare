# Workers Overview

This directory contains **Cloudflare Workers** that power the backend infrastructure for the **Gist AI note-taking application**.  
These serverless functions handle **authentication, AI processing, file storage, and observability**.

---

## ğŸ—ï¸ Worker Architecture

```mermaid
graph LR
    A[Chrome Extension] --> B[notion-oauth-worker]
    A --> C[r2-storage-worker]

    B --> D[Secret Store]
    B --> E[OAuth Providers]

    C --> F[R2 Storage]
    C --> G[AI Gateway]
    C --> H[Whisper AI]
    C --> I[BART AI]

    G --> H
    G --> I
```
## ğŸ“ Workers Structure

### ğŸ” `./notion-oauth-worker/`

**Purpose:** Authentication and credential management  

**Key Features:**
- Secret Store integration for secure credential management  
- Multi-platform OAuth (Notion + Microsoft OneNote)  
- CORS handling for Chrome extension requests  
- Comprehensive error logging and debugging  

---

### ğŸ¤– `./r2-storage-worker/`

**Purpose:** AI processing and file storage  

**Key Features:**
- Audio file upload and storage in **Cloudflare R2**  
- AI-powered transcription using **Whisper-large-v3-turbo**  
- Text summarization with **BART-large-cnn**  
- Structured JSON logging for observability  
- Performance analytics and compression metrics  

---

### ğŸ”§ Shared Technologies

#### Core Platform
- **Cloudflare Workers** â€“ Serverless compute platform  
- **ES6 Modules** â€“ Modern JavaScript module system  
- **Wrangler CLI** â€“ Deployment and development tools  

#### Storage & Security
- **Cloudflare R2** â€“ S3-compatible object storage  
- **Secret Store** â€“ Centralized credential management  
- **Environment Variables** â€“ Configuration management  

#### AI & Processing
- **AI Gateway** â€“ Request routing, caching, and analytics  
- **OpenAI Whisper** â€“ Speech-to-text transcription  
- **Facebook BART** â€“ Text summarization  
- **Binary Processing** â€“ Audio encoding and file handling  

#### Observability
- **Structured Logging** â€“ JSON-formatted logs  
- **Request Tracking** â€“ Unique request IDs for debugging  
- **Performance Metrics** â€“ Timing and compression analytics  
- **Error Handling** â€“ Comprehensive exception tracking  

#### External Services
- **Notion API** â€“ Note creation & workspace integration  
- **Microsoft Graph** â€“ OneNote support  
- **OpenAI Services** â€“ via Cloudflare AI Gateway  
- **Facebook AI** â€“ BART summarization  

---
## ğŸ“Š Performance & Monitoring

### ğŸ”„ Request Flow
1. **Authentication** â€“ OAuth worker validates and exchanges tokens  
2. **File Upload** â€“ Audio files stored directly in the **R2 bucket**  
3. **AI Processing** â€“ Transcription and summarization run **in parallel**  
4. **Response** â€“ Returns structured data with performance metrics  

---

### ğŸ” Observability Features
- **End-to-End Request Tracing** â€“ Each request tagged with a unique UUID  
- **Processing Time Metrics** â€“ Detailed timing for every operation  
- **Business Analytics** â€“ File sizes, compression ratios, and success rates  
- **Error Tracking** â€“ Detailed stack traces for easier debugging  

## ğŸ” Security Features

### Secret Management
- **Centralized credential storage** in Secret Store  
- **No hardcoded secrets** â€“ all sensitive data managed securely  
- **Environment-specific configs** for staging/production  

### Authentication
- **OAuth 2.0 flows** for Notion and OneNote  
- **Proper JWT validation**  
- **Strict CORS configuration** for Chrome extension origins  

